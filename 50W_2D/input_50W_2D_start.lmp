## LAMMPS input start file for filtration research  
## Written by Kevin Van Slyke  
## Dated: 04_02_2018

## Multi neighbor and comm for efficiency 
neighbor    1 multi 
neigh_modify    delay 0 
comm_modify    mode multi 

thermo    1000    #Print thermo vars every 1000 timesteps 

## Set simulation unit and atom style to dimensionless LJ particles 
units    lj    #Simple Lennard-Jones cut-off potential 
atom_style     atomic     #Particles have mass 
dimension    2    #Fix simulation to 2D 
boundary    p f p    #Set boundaries such that x_axis=fixed, y_axis=periodic, z_axis=periodic 
lattice    sq 1    #Simple square lattice with one basis atom per cell, lattice_spacing=1/1=1, reduced density rho = 1 
region    box block 0 2005 -1 2001 -0.01 0.01    #Create extruded rectangular simulation volume in units of lattice sites, 0<=x<2005, -1<=y<2001, -0.01<=z<0.01 
create_box    5 box    #Create simulation volume in region box with 5 atom types 
timestep    0.005    #One timestep=0.005*tau, tau=2.17*10^(-12)s for Argon 

## LJ potential: atom type 1, atom type 2, epsilon, sigma 
pair_style    lj/cut 1.1225    #Lennard-Jones global cut-off=1.1225 
pair_coeff     1 1 1.0 1.0 0.5     #Pairwise 1-1 interaction, epsilon=1.0, sigma=1.0, cut-off=0.5 
pair_coeff     1 2 1.0 1.0 1.1225     #Pairwise 1-2 interaction, epsilon=1.0, sigma=1.0, cut-off=1.1225 
pair_coeff     1 3 1.0 1.0 1.1225     #Pairwise 1-3 interaction, epsilon=1.0, sigma=1.0, cut-off=1.1225 
pair_coeff     1 4 1.0 1.5 1.68375     #Pairwise 1-4 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     1 5 1.0 1.5 1.68375     #Pairwise 1-5 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     2 2 1.0 1.0 1.1225     #Pairwise 2-2 interaction, epsilon=1.0, sigma=1.0, cut-off=1.1225 
pair_coeff     2 3 1.0 1.0 1.1225     #Pairwise 2-3 interaction, epsilon=1.0, sigma=1.0, cut-off=1.1225 
pair_coeff     2 4 1.0 1.5 1.68375     #Pairwise 2-4 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     2 5 1.0 1.5 1.68375     #Pairwise 2-5 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     3 3 1.0 1.0 1.1225     #Pairwise 3-3 interaction, epsilon=1.0, sigma=1.0, cut-off=1.1225 
pair_coeff     3 4 1.0 1.5 1.68375     #Pairwise 3-4 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     3 5 1.0 1.5 1.68375     #Pairwise 3-5 interaction, epsilon=1.0, sigma=1.5, cut-off=1.68375 
pair_coeff     4 4 1.0 2.0 2.245     #Pairwise 4-4 interaction, epsilon=1.0, sigma=2.0, cut-off=2.245 
pair_coeff     4 5 1.0 2.0 2.245     #Pairwise 4-5 interaction, epsilon=1.0, sigma=2.0, cut-off=2.245 
pair_coeff     5 5 1.0 2.0 2.245     #Pairwise 5-5 interaction, epsilon=1.0, sigma=2.0, cut-off=2.245 
mass    1 1000    #Sets mass of particle type 1 to 1000 
mass    2 1    #Sets mass of particle type 2 to 1 
mass    3 1    #Sets mass of particle type 3 to 1 
mass    4 4    #Sets mass of particle type 4 to 4 
mass    5 4    #Sets mass of particle type 5 to 4 
pair_modify    shift yes    #Shifts LJ potential to 0.0 at the cut-off 

## Define the filter area and fill it with atoms fixed to lattice sites 
region    topWall block 1000 1004 1026 2000 0 0    #Top half of single pore filter 
region    botWall block 1000 1004 0 974 0 0    #Bottom half of single pore filter 
region    frontVacuum block 3 992 3 1997 0 0    #Front Region to be filled by gas 
region    rearVacuum block 1008 2002 3 1997 0 0    #Rear Region to be filled by gas 
region    vacuum union 2 frontVacuum rearVacuum 
create_atoms    1 region topWall 
create_atoms    1 region botWall 
group    topFilter region topWall 
group    botFilter region botWall 
group    filter union topFilter botFilter 
## Define the flow area and populate with gas molecules 
create_atoms    2 random 94990 59290 vacuum    #Create atoms: type=2, placement=random, N=94990, seed=59290, region=vacuum 
create_atoms    3 random 10 89021 vacuum    #Create atoms: type=3, placement=random, N=10, seed=89021, region=vacuum 
create_atoms    4 random 4990 258153 vacuum    #Create atoms: type=4, placement=random, N=4990, seed=258153, region=vacuum 
create_atoms    5 random 10 299871 vacuum    #Create atoms: type=5, placement=random, N=10, seed=299871, region=vacuum 
group    gas type 2:5    #Create group of freely moving particles 
group    argon type 2 3  #Create group of freely moving Argon gas particles 
group    tracer type 3 5   #Create group of the less common impurity particles 
group    impurity type 4 5   #Create group of the less common impurity particles 

## Thermodynamic calculation method and dynamics 
fix    1 gas nve    #Fix microcanonical ensemble 
fix    2 filter setforce 0.0 0.0 0.0  #Fix force on filter to zero 
fix    3 gas wall/reflect ylo 0 yhi 2000    #Fix walls parallel to xz plane at y=0 and y=2000 to reflect particles 
fix    4 all enforce2d    #Fix motion along the z-axis to simulate 2D 

## All parameters but filter and velocities are set so we minize energy to prevent overlap of particles 
minimize    0.0001 0.0001 1000000 1000000  #Stopping tolerances: energy=0.0001, force=0.0001, max iterations=1000000, max evaluations=1000000 
reset_timestep    0 

## Define velocity for initialization of gas and fixing filter 
velocity	filter set 0.0 0.0 0.0     #Set initial velocity of walls to zero 
velocity    argon create 1 258153 dist gaussian    #Create velocity of Argon particles from a Gaussian distribution at temperature=1 with random seed=258153 
velocity    argon set 1 0 0 sum yes units box    #Add initial fluid velocity bias of v_x=1 (towards the filter) to the Argon 
velocity    impurity create 1 15541 dist gaussian    #Create velocity of large particles from a Gaussian distribution at temperature=1 with random seed=15541 
## Compute thermodynamic temperature based only on gas molecules 
compute    gasTemp gas temp 

## Define regions in which Pressure will be calculated and inside of the pore 
region    pressureRegion block 900 1000 0 2000 -0.01 0.01 
group    pressureGroup dynamic gas region pressureRegion every 1000 
compute    Pp pressureGroup stress/atom gasTemp ke pair 
compute    Ps pressureGroup reduce sum c_Pp[1] c_Pp[2] 
variable    Px equal -(c_Ps[1])/(100*2000) 
variable    Py equal -(c_Ps[2])/(100*2000) 
variable    P equal (v_Px+v_Py)/2 

thermo_style    custom step etotal ke pe c_gasTemp press v_P 

variable movieTimes equal stride2(0,2000100,1000100,0,100000,100) 
## Extra dump of mass and position in the region around the pore for making movies 
region    rawPore block 875 1125 875 1125 0 0    #Define region immediately inside pore to use for dumping atom data 
group    rawMovie dynamic all region rawPore every 100    #Make a dynamic group of particles in pore region every N=100 timesteps 
dump    10 rawMovie custom 100 dump_50W_2D_rawMovie_start.lmp type x y    #Dump pore group atom data every N=100 timesteps to file dump_50W_2D_rawMovie_start.lmp including atom: type, x position, y position in that order 
dump_modify 10 flush yes every v_movieTimes 
thermo_modify flush yes 
restart 100000 50W_2D_archive.restart 50W_2D_backup.restart 
restart 1000000 50W_2D_archive.restart 
run 1000001 pre yes post yes 
